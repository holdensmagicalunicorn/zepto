<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Zepto unit tests</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <script src="../src/zepto.js"></script>
  <script src="../src/classlist.js"></script>
  <script src="evidence.js"></script>
</head>
<body>
  <h1>Zepto unit tests</h1>
  <p>
    See the browser console for results.
  </p>
  <div id="some_element"></div>
  <p>
    <span class="yay">yay</span>
    <span></span>
    <span class="nay" id="nay">nay</span>
  </p>
  <script>  
    Evidence.TestCase.extend('ZeptoTest', {
      
      testDollar: function(t){
        t.assert($('#some_element').get().length == 1);
        t.assert($('#some_element').get(0) == document.getElementById('some_element'));
        
        t.assert($('span').get().length == 3);
        t.assert($('p>span.yay').get().length == 1);      
      },
      
      testCSS: function(t){
        var el = $('#some_element').get(0);
        
        $('#some_element').css('color:#f00;border:1px solid rgba(255,0,0,1)');
        t.assertEqual('rgb(255, 0, 0)', el.style.color);
        t.assertEqual('rgb(255, 0, 0)', el.style.borderLeftColor);
        t.assertEqual('1px', el.style.borderLeftWidth);
      },
      
      testChaining: function(t){
        t.assert(document.getElementById('nay').innerHTML == "nay");
        $('span.nay').css('color:red').html('test');
        t.assert(document.getElementById('nay').innerHTML == "test");
      },
      
      testPlugins: function(t){
        var el = $('#some_element').get(0);
        
        $.fn.plugin = function(){
          return this.each(function(el){ el.innerHTML = 'plugin!' });
        };
        $('#some_element').plugin();
        t.assertEqual('plugin!', el.innerHTML);
      },
      
      testClassList: function(t){
        var $el = $('#some_element');
        var el = $el.get(0);
        
        var originalClassName = el.className;
        
        //-- used indexOf to test for classes existence since we can't rely on the order of the class names
        /* */
        //single add
        $el.addClass('foo');
        t.assert(el.className.indexOf('foo') >= 0);
        t.assert($el.hasClass('foo'));
        
        //multiple add
        $el.addClass('foo bar');
        t.assert(el.className.indexOf('foo') >= 0);
        t.assert(el.className.indexOf('bar') >= 0);
        t.assert($el.hasClass('foo'));
        t.assert($el.hasClass('bar'));
        
        //-- now we have sure we have/haven't all the classes we want to check
        
        //single add
        $el.addClass('mixedCase');
        t.assert(el.className.indexOf('foo') >= 0);
        t.assert(el.className.indexOf('bar') >= 0);
        t.assert(el.className.indexOf('mixedCase') >= 0);
        t.assert($el.hasClass('foo'));
        t.assert($el.hasClass('bar'));
        t.assert($el.hasClass('mixedCase'));
        
        //single remove
        $el.removeClass('mixedCase');
        t.assert(el.className.indexOf('foo') >= 0);
        t.assert(el.className.indexOf('bar') >= 0);
        t.assert(el.className.indexOf('mixedCase') == -1);
        t.assert($el.hasClass('foo'));
        t.assert($el.hasClass('bar'));
        t.assert(! $el.hasClass('mixedCase'));
        
        //single remove
        $el.removeClass('bar');
        t.assert(el.className.indexOf('foo') >= 0);
        t.assert(el.className.indexOf('bar') == -1);
        t.assert(el.className.indexOf('mixedCase') == -1);
        t.assert($el.hasClass('foo'));
        t.assert(! $el.hasClass('bar'));
        t.assert(! $el.hasClass('mixedCase'));
        
        //multiple add
        $el.addClass('foo bar mixedCase');
        t.assert(el.className.indexOf('foo') >= 0);
        t.assert(el.className.indexOf('bar') >= 0);
        t.assert(el.className.indexOf('mixedCase') >= 0);
        t.assert($el.hasClass('foo'));
        t.assert($el.hasClass('bar'));
        t.assert($el.hasClass('mixedCase'));
        
        //single toggle #1
        $el.toggleClass('foo');
        t.assert(el.className.indexOf('foo') == -1);
        t.assert(el.className.indexOf('bar') >= 0);
        t.assert(el.className.indexOf('mixedCase') >= 0);
        t.assert(! $el.hasClass('foo'));
        t.assert($el.hasClass('bar'));
        t.assert($el.hasClass('mixedCase'));
        
        //single toggle #2
        $el.toggleClass('foo');
        t.assert(el.className.indexOf('foo') >= 0);
        t.assert(el.className.indexOf('bar') >= 0);
        t.assert(el.className.indexOf('mixedCase') >= 0);
        t.assert($el.hasClass('foo'));
        t.assert($el.hasClass('bar'));
        t.assert($el.hasClass('mixedCase'));
        
        //multiple toggle #1
        $el.toggleClass('mixedCase bar foo');
        t.assert(el.className.indexOf('foo') == -1);
        t.assert(el.className.indexOf('bar') == -1);
        t.assert(el.className.indexOf('mixedCase') == -1);
        t.assert(! $el.hasClass('foo'));
        t.assert(! $el.hasClass('bar'));
        t.assert(! $el.hasClass('mixedCase'));
        
        //multiple toggle #2
        $el.toggleClass('mixedCase bar foo');
        t.assert(el.className.indexOf('foo') >= 0);
        t.assert(el.className.indexOf('bar') >= 0);
        t.assert(el.className.indexOf('mixedCase') >= 0);
        t.assert($el.hasClass('foo'));
        t.assert($el.hasClass('bar'));
        t.assert($el.hasClass('mixedCase'));
        
        //multiple toggle #3
        $el.toggleClass('foo bar');
        t.assert(el.className.indexOf('foo') == -1);
        t.assert(el.className.indexOf('bar') == -1);
        t.assert(el.className.indexOf('mixedCase') >= 0);
        t.assert(! $el.hasClass('foo'));
        t.assert(! $el.hasClass('bar'));
        t.assert($el.hasClass('mixedCase'));
        
        //remove all
        $el.removeClass();
        t.assert(el.className.indexOf('foo') == -1);
        t.assert(el.className.indexOf('bar') == -1);
        t.assert(el.className.indexOf('mixedCase') == -1);
        t.assert(! $el.hasClass('foo'));
        t.assert(! $el.hasClass('bar'));
        t.assert(! $el.hasClass('mixedCase'));
        
        //remove all #2 - test is something weird happens if called multiple times
        $el.removeClass();
        t.assert(el.className.indexOf('foo') == -1);
        t.assert(el.className.indexOf('bar') == -1);
        t.assert(el.className.indexOf('mixedCase') == -1);
        t.assert(! $el.hasClass('foo'));
        t.assert(! $el.hasClass('bar'));
        t.assert(! $el.hasClass('mixedCase'));
        
        //multiple add
        $el.toggleClass('mixedCase bar foo');
        t.assert(el.className.indexOf('foo') >= 0);
        t.assert(el.className.indexOf('bar') >= 0);
        t.assert(el.className.indexOf('mixedCase') >= 0);
        t.assert($el.hasClass('foo'));
        t.assert($el.hasClass('bar'));
        t.assert($el.hasClass('mixedCase'));
        
        //multiple add #2 - ensure it is not adding same string multiple times
        $el.toggleClass('mixedCase bar foo');
        t.assert(el.className.indexOf('foo') == el.className.lastIndexOf('foo'));
        t.assert(el.className.indexOf('bar') == el.className.lastIndexOf('bar'));
        t.assert(el.className.indexOf('mixedCase') == el.className.lastIndexOf('mixedCase'));
        
        //single add - ensure it is not adding same string multiple times
        $el.toggleClass('mixedCase lorem');
        t.assert(el.className.indexOf('foo') == el.className.lastIndexOf('foo'));
        t.assert(el.className.indexOf('bar') == el.className.lastIndexOf('bar'));
        t.assert(el.className.indexOf('mixedCase') == el.className.lastIndexOf('mixedCase'));
        t.assert(el.className.indexOf('lorem') == el.className.lastIndexOf('lorem'));
        
        //restore previous state and check if worked properly
        $el.removeClass();
        t.assert(el.className.indexOf('foo') == -1);
        t.assert(el.className.indexOf('bar') == -1);
        t.assert(el.className.indexOf('mixedCase') == -1);
        t.assert(! $el.hasClass('foo'));
        t.assert(! $el.hasClass('bar'));
        t.assert(! $el.hasClass('mixedCase'));
        
        $el.addClass(originalClassName);
        originalClassName.split(/ +/g).forEach(function(c){
        	t.assert(el.className.indexOf(c) >= 0);
        	t.assert(el.className.indexOf(c) == el.className.lastIndexOf(c));
        	t.assert($el.hasClass(c));
        });
        /* */
      }

    });
  </script>
</body>
</html>